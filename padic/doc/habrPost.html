&lt;!DOCTYPE html&gt;
<html>
<head>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<h1 id="p-адические-числа-и-их-реализация-на-haskell">p-адические числа и их реализация на Haskell</h1>
<p>Сегодня я предлагаю заглянуть в один любопытный уголок теории чисел, в котором обитают p-адические числа, а попутно познакомить с некоторыми классными инструментами в системе типов Haskell – с типами-литералами и семействами типов. Есть опасения, что статья, рассказывающая о нескольких неочевидных вещах сразу, будет чересчур сложной, но мне кажется, что смысл рискнуть, всё же, есть. Рассказывая об абстрактных математических концепциях, хорошо иметь перед собой практические примеры их работы, а для “объяснения” этих абстракций компьютеру, бывают полезны специальные “педагогические” приёмы.</p>
<p>Я люблю язык Haskell оттого, что начиная с какого-то времени мне стало комфортно на нём думать. Это, конечно, дело вкуса и опыта, но многое в языке помогает в этом. Во-первых, он функционален и декларативен, а значит, алгоритмы, легко превращать в определения и наоборот. Во вторых, его система типов позволяет поднять размышления о том, что же ты делаешь на новый уровень осознанности, так что алгоритмы, являющиеся по существу, числодробилками, на Haskell таковыми не выглядят.</p>
<p>Оказалось, что в репозитории <a href="https://hackage.haskell.org/">hackage</a>, основном для Haskell-сообщества, нет библиотеки для работы с p-адическими числами, даже в таких серьёзных теоретико-числовых библиотеках, как <a href="https://hackage.haskell.org/package/arithmetic">arithmetic</a>, <a href="https://hackage.haskell.org/package/arithmoi">arithmoi</a> или <a href="https://hackage.haskell.org/package/factory">factory</a>. Я написал и опубликовал свой модуль padic, и расскажу о некоторых деталях его реализации.</p>
<p>В арсенале профессионалов и настоящих мастеров подчас попадаются странные инструменты. Не сразу можно сказать для чего они нужны и как они, вообще, могут быть полезными. Но при решении каких-то особенных задач они оказываются незаменимыми. Начиная с какого-то уровня погружения в теорию чисел, алгебраическую геометрию, квантовую механику или теорию струн, авторы книг и статей зачастую переходят от привычных целых и вещественных чисел к p-адическим числам и при этом удивительным образом чувствуют, что им становится легче. По По крайней мере у меня, первое знакомство с ними ощущения лёгкости не создало. В сети достаточно много вводных материалов по этой теме, как виде книг, статей и блогов, так и в форме видео. В конце этой статьи я приведу ссылки на материалы, показавшиеся мне особенно интересными и полезными. Большинство из этих введений начинается с определения p-адической нормы, а завершается упоминанием фрактальной (канторовой) топологии, которую эти числа образуют. При этом приводится пара канонических примеров необычности этой числовой системы, таких как сходимость суммы всех положительных степеней двойки к минус единице или возможность получить целочисленные квадратные корни из 2, 5 или 7. В более серьёзных книгах всё внезапно становится существенно более сложным, поскольку вдруг авторам становится важно не то как складывать и умножать эти числа, а то что они образуют проективный предел колец вычетов относительно естественных проекций или что образуемое ими метрическое пространство неархимедово. Это похоже на ситуацию с многочисленными введениями в монады, ну, вы понимаете о чём я… Поэтому мы сегодня постараемся, отталкиваясь от простой арифметики, пройти несколько дальше и понять в чём практический смысл введения этих числовых монстров.</p>
<h2 id="начинаем-с-цифр">Начинаем с цифр</h2>
<p>Что мы имеем в виду, когда записываем число рядом цифр? – То, что его можно представить в виде взвешенной суммы степеней некоторого основания, натурального числа, не равного нулю или единице. Обычно мы работаем с основанием 10, равным числу пальцев на руках, в “цифровом” мире повсеместно используется самое маленькое из возможных основание 2, ну, а при записи времени нам оказалось удобным использовать смешанную систему с основаниями 12 и 60. В позиционной записи числа цифры выбираются из конечного множества возможных остатков деления на основание, а позиция цифры в ряду, обозначающем число, соответствует степени основания. Это всё привычно и поэтому кажется простым. Более того, в повседневности мы складываем и вычитаем, умножаем и делим, а также сравниваем не числа, а их позиционную запись (расширенную знаком “минус” для отрицательных чисел), а это значит, мы рассчитываем на то, что множество чисел и множество их позиционных представлений “работают” одинаково. Если мы выберем в качестве представления числа не цепочки цифр, а какие-то количественные меры, например, шаги на бесконечной ленте, то результаты сложения “в столбик по цифрам” и непосредственно по шагам на этой ленте будут согласованы. Это же относится и к другим операциям и свойствам. Говоря на языке математики, мы рассчитываем на изоморфизм между двумя числовыми системами: системой целых чисел и системой, которое образуют последовательности цифр вместе со знакомыми нам со школы операциями поразрядного сложения, вычитания и умножения. Более того, цифры при выполнении этих операций тоже ведут себя как элементы числовой системы – системы вычетов по модулю выбранного основания. Это значит, что цифры тоже можно складывать, вычитать и умножать, но по правилам модулярной арифметики, у которой тоже есть хорошо знакомый нам “нецифровой” аналог: шаги по замкнутой ленте.</p>
<p>Далее я буду использовать математические имена и обозначения для этих числовых систем. Система целых чисел (изоморфная шагам по бесконечной в обе стороны ленте) является <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BC%D0%BC%D1%83%D1%82%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BB%D1%8C%D1%86%D0%BE">кольцом</a> и обозначается <span class="math display">ℤ</span>. Цифры, используемые при записи числа в позиционной записи с основанием <span class="math display"><em>b</em></span> образуют <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BB%D1%8C%D1%86%D0%BE_%D0%B2%D1%8B%D1%87%D0%B5%D1%82%D0%BE%D0%B2">кольцо вычетов</a> по модулю <span class="math display"><em>m</em></span>, которое мы будем обозначать как <span class="math display">ℤ/<em>m</em>ℤ</span>. Эта система изоморфна шагам по замкнутой ленте, вмещающей ровно <span class="math display"><em>m</em></span> ячеек или отметок.</p>
<p>В кольце можно складывать, вычитать и перемножать любые элементы, оставаясь в этом же кольце. А вот деление возможно не всегда, например, в кольце <span class="math display">ℤ</span> нет такого элемента, который был бы равен <span class="math display">2/3</span>, то есть, решал бы уравнение <span class="math display">3<em>x</em> = 2</span>. Для того, чтобы можно было делить на любой ненулевой элемент, кольцо <span class="math display">ℤ</span> расширяется до <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D0%B5_(%D0%B0%D0%BB%D0%B3%D0%B5%D0%B1%D1%80%D0%B0)">поля</a> рациональных чисел <strong>Q</strong>.</p>
<p>Кольца вычетов конечны, и может показаться, что их возможности меньше бесконечного кольца целых чисел, но это не так. В них, даже в совсем небольших, можно обнаружить то, чего нет в целых числах. Например, в кольце <span class="math display">ℤ/5ℤ</span> из пяти элементов <span class="math display">{0, 1, 2, 3, 4}</span> у каждого элемента есть противоположный, то есть такой, что в сумме они дают ноль. То есть, в этом смысле оно включает в себя “отрицательные числа”: <span class="math display">1 =  − 4, 2 =  − 3, 3 =  − 2, 4 =  − 1</span>. Более того, в этой системе у любого корректного линейного уравнения есть решение, то есть, у каждого ненулевого элемента есть обратный, такой, что их произведение равно еднице. То есть, оно содержит все возможные формальные дроби: <span class="math display">1 = 1/4 = 3/2, 2 = 1/3 = 3/4, 3 = 1/2 = 4/3, 4 = 2/3</span>. Значит, это уже не только кольцо, но и поле. Каждое кольцо вычетов по модулю, являющемуся простым числом, образует поле.</p>
<p>Но это ещё не все “сокровища”. В кольце <span class="math display">ℤ/5ℤ</span> есть то, чего нет ни в целых, ни в рациональных числах, а именно <span class="math display">$$\sqrt{-1}$$</span>, ведь <span class="math display">2<sup>2</sup> = 4 =  − 1</span>. Это вовсе не значит, что 2 это мнимая единица, просто уравнение <span class="math display"><em>x</em><sup>2</sup> + 1 = 0</span> решается в этом кольце. Кольца вычетов разные и у каждого есть свои интересные особенности, например, в кольце привычных нам цифр <span class="math display">ℤ/10ℤ</span> нет всех возможных дробей, но зато в нём есть делители нуля, то есть, такие ненулевые числа, которые в произведении дают 0. А ещё в нём есть числа, равные своим квадратам: это 5 и 6 (помните рифмы в таблице умножения: “пятью-пять – двадцать пять, шесть-шесть – тридцать шесть”? В кольце десятичных цифр нас интересуют только последние цифры результатов.). Таким образом, уравнение <span class="math display"><em>x</em>(<em>x</em>−1) = 0</span> имеет в этом кольце целых четыре различных корня из которых два нетривиальны!</p>
<h2 id="поднимаемся-выше">Поднимаемся выше</h2>
<p>Кольца вычетов разные, но каждое из них порождает целое семейство потомков, которым они передают часть своих особенностей, но каждый из которых способен пойти дальше своего родителя. Потомками кольца <span class="math display">ℤ/<em>m</em>ℤ</span> можно считать кольца <span class="math display">ℤ/<em>m</em><sup>2</sup>ℤ</span>, <span class="math display">ℤ/<em>m</em><sup>3</sup>ℤ</span> и т.д. Рассмотрим, например, кольцо <span class="math display">ℤ/25ℤ</span>. В нём тоже есть все “отрицательные числа” и большая часть дробей (кроме тех, что имеют знаменатель, кратный 5). Имеется в нём и <span class="math display">$$\sqrt{-1} = \pm7$$</span>, а также появляются корни из <span class="math display"> ± 6</span> и <span class="math display"> ± 11</span>, которых не могло быть в <span class="math display">ℤ/5ℤ</span>. В кольце <span class="math inline">ℤ/125ℤ</span> остаётся всё то же, что было у потомков, но расширяется набор квадратных уравнений, имеющих решения и появляется возможность решать некоторые кубические уравнения.</p>
<p>А интересно, если продолжать наращивать степени и новые возможности, то какими свойствами будет обладать кольцо <span class="math display">ℤ/5<sup>∞</sup>ℤ</span>? На этот вопрос и ответил Курт Гензель, определив для такого предельного кольца числовую систему и описав его свойства. Система <span class="math display">ℤ/<em>p</em><sup>∞</sup>ℤ</span>, порождаемая кольцом вычетов <span class="math display">ℤ/<em>p</em>ℤ</span> называется системой целых p-адических чисел и обозначается <span class="math display">ℤ<sub><em>p</em></sub></span>. Она включает в себя всех своих родителей, как подкольца и обладает всеми их свойствами сразу! Однако при устремлении к бесконечности количество переходит в качество и мы получаем нечто новое: бесконечное кольцо, которое включает в себя в качестве подкольца все <span class="math display">ℤ</span> целиком, но кроме того, содержит все формальные дроби со знаменателями, не кратными основанию <span class="math display"><em>p</em></span> и решения широкого класса алгебраических уравнений линейных, квадратных и высших степеней! Не любых, конечно, а только тех, что решаются в кольцах-родителях, но это “не баг, а фича”, поскольку позволяет относительно легко определить существует ли решение у заданного алгебраического уравнения, что в целых или рациональных числах представляет крайне сложную задачу. Достаточно вспомнить, Великую теорему Ферма о существовании решения уравнения <span class="math display"><em>x</em><sup><em>n</em></sup> + <em>y</em><sup><em>n</em></sup> =  = <em>z</em><sup><em>n</em></sup></span> в целых числах, на доказательство которой ушло три столетия, и не удивительно, что в том доказательстве, что представил Энрю Уайлз, используются p-адические числа.</p>
<p>Но это ещё не что можно построить “поднимая” кольца вычетов до предельных колец целых p-адических чисел. Запрет на дроби со знаменателем, кратным основанию <span class="math inline"><em>p</em></span>, достаточно жестко ограничивает нас в выборе доступных математических инструментов. Его можно изящно обойти, если рассмотреть произведение <span class="math display"><em>u</em> ⋅ <em>p</em><sup><em>v</em></sup>, <em>u</em> ∈ ℤ<sub><em>p</em></sub>, <em>v</em> ∈ ℤ</span>. В ней число <span class="math display"><em>u</em></span> – обратимое целое p-адическое число (для которого всегда можно вычислить <span class="math display"><em>u</em><sup>−1</sup></span>), а второе – показатель степени при основании <span class="math display"><em>p</em></span>. Таким образом, рассматривая числа <span class="math display"><em>y</em><sub>1</sub> = <em>u</em><sub>1</sub> ⋅ <em>p</em><sup><em>v</em><sub>1</sub></sup></span> и <span class="math display"><em>y</em><sub>2</sub> = <em>u</em><sub>2</sub> ⋅ <em>p</em><sup><em>v</em><sub>2</sub></sup></span>, мы всегда сможем найти их отношение <span class="math display">$$\frac{y_1}{y_2} = \frac{u_1}{u_2}\cdot p^{v1-v2}$$</span>. Это позволяет нам дополнить кольцо целых чисел <span class="math display">ℤ<sub><em>p</em></sub></span> до поля рациональных чисел <span class="math display">ℚ<sub><em>p</em></sub></span>. Если <span class="math display"><em>p</em></span> – простое число, то у нас этот трюк точно получится, поскольку в этом случае кольцо <span class="math display">ℤ/<em>p</em>ℤ</span> не содержит делителей нуля, а все делители нуля у потомков обязаны содерать в себе в качестве множителя <span class="math display"><em>p</em></span>. Но все такие множители мы вынесли в выражение <span class="math display"><em>p</em><sup><em>v</em></sup></span>, а значит, любое число <span class="math display"><em>u</em></span> будет обратимым.</p>
<p>Итак, несложный трюк, хорошо знакомый всем компьютерщикам и физикам (подобный разделению числа на мантиссу и порядок, только не в степенях десяти, а в степенях основания) помог нам повысить статус p-адических чисел до полноценного поля, которое теперь включает в себя в качестве подкольца целиком все кольцо целых чисел <span class="math display">ℤ</span>, в качесте подполя целиком всё поле рациональных чисел <span class="math display">ℚ</span>, а помимо них бесконечное множество других элементов, решающих алгебраические уравнения!</p>
<p>Но, возникает вопрос: откуда же взялись все эти дополнительные числа? Описанный нами процесс повышения степени колец вычетов <span class="math display">ℤ/<em>p</em>ℤ → ℤ/<em>p</em><sup>2</sup>ℤ → ℤ/<em>p</em><sup>2</sup>ℤ → ...</span> всё время расширял кольца новыми <strong>целыми числами</strong>, принадлежащими кольцам <span class="math display">ℤ/<em>p</em><sup><em>k</em></sup>ℤ</span>. Все наши формальные дроби и квадратные корни всегда совпадали с какми-то целыми числами и были от них неотличимы. Значит ли это, что и в <span class="math display">ℤ<sub><em>p</em></sub></span> дроби и алгебраические корни тоже будут какими-то целыми числами, совпадающими с “нормальными”. И да и нет. Да – они все будут целыми, нет – они все будут отличаться и друг от друга и от элементов подкольца <span class="math display">ℤ<sub><em>p</em></sub></span>. Тут работает магия предельного перехода.</p>
<h2 id="возвращаемся-к-цифрам">Возвращаемся к цифрам</h2>
<p>Что мы делаем, когда хотим выразить сложную мысль? – используем много букв. А если нужно выразить большое целое число? – тогда нужно использовать много цифр и позиционную запись. А как цифрами записать p-адическое число? Начём опять с маленького кольца, а именно с <span class="math display">ℤ/5ℤ</span>. Все его элементы уникальны и принадлежат множеству цифр <span class="math display">{0, 1, 2, 3, 4}</span>. Поднимемся на ступень выше, перейдя в кольцо <span class="math display">ℤ/25ℤ</span>. Можно каждому элементу этого кольца назаначить свой символ, скажем, из английского алфавита, а можно воспользоваться тем, что в этом кольце ровно <span class="math display">5 × 5</span> элементов, ни больше ни меньше, а значит каждому из них можно поставить в соответствие пару элементов из <span class="math display">{0, 1, 2, 3, 4}</span>, которых будет в точности <span class="math display">5<sup>2</sup></span>. И соответствие это можно сделать не каким попало, а естественным, сохраняющим числовые свойства цифр и элементов <span class="math display">ℤ/25ℤ</span>. Для этого достаточно использовать принципы позиционной записи, представив число <span class="math display"><em>x</em></span> из <span class="math display">ℤ/25ℤ</span> как сумму <span class="math display">5<em>b</em> + <em>a</em></span> используя цифры <span class="math display"><em>a</em>, <em>b</em> ∈ ℤ/5ℤ</span>. Получим хорошо знакомую пятиричную систему счисления, которая позволяет подниматься по степеням основания, повышая разрядность записи числа. Так для записи любого числа из <span class="math display">ℤ/5<sup><em>k</em></sup>ℤ</span> потребуется цепочка из <span class="math display"><em>k</em></span> пятиричных цифр. А это значит, что 5-адическое число будет записываться бесконечной цепочкой пятиричных цифр: <span class="math display">$$$ x = \overline{...fedcba}_5 = ... 5^5 f + 5^4 e +  5^3 d + 5^2 c +  5 b + a$$</span>$ Такая запись называется каноническим разложением p-адического числа и оно уникально для каждого из них. И вот тут-то у нас и появляется куча свободного места!</p>
<p>Все целые числа записываются конечным числом цифр. Задумайтесь над этим, множество целых чисел не ограничено сверху, однако сколь бы большое число вы ни выбрали (хоть знаменитое число Грэма, хоть его факториал) оно всегда может быть представлено <em>конечным</em> числом цифр. Таким образом, любое целое число можно представить как p-адическое, добавив бесконечную цепочку нулей после старшего разряда. Но p-адические числа могут иметь и любые ненулевые числа в своём бесконечном хвосте. И этот хвост бесконечно длинее любого конечного начала. Таким образом, множество p-адических много больше множества целых! Насколько много? Настолько же, насколько иррациональных чисел больше чем рациональных. Бесконечное разнообразие бесконечных последовательностей из конечного набора цифр образует континуум!</p>
<p>Добавляя степень основания для перехода к рациональным p-адическим числам, мы вводим аналог десятичной точки, разделяя p-адическое число в каноническом разложении на конечную дробную и бесконечную целую части. Вот примеры некоторых p-адических чисел:</p>
<p><span class="math display">$$\begin{align*}
\sqrt 17 &amp;= …110110000011111110000010000001.0_2\\
\sqrt{-1} &amp;= …141421404340423140223032431212.0_5\\
\frac{617}{500} &amp;= 0.1234_{10}\\
\frac{617}{500}\cdot\frac1{17} &amp;= …294117647058823529411764705882.3602_{10}\\
\end{align*}
$$</span></p>
<p>Если долго смотреть на этот бесконечный хвост, уходящий влево, становится не по себе. Собственно “бесконечных” чисел в математике не существует, смысла в них немного. Что же значат числа, записываемые заведомо бесконечным числом разрядов? В некотором смысле то же, что и числа с бесконечным числом разрядов, но только уходящих направо от десятичной запятой, как в десятичных дробях, к ним-то мы привыкли! Вполне безобидное конечное число 1/3 имеет в десятичной позиционной системе бесконечную последовательность цифр 0.33333333… Множество рациональных чисел в десятичной записи тоже включает в себя все натуральные числа, как такое подмножество, у которого справа от запятой начинается бесконечная цепочка нулей. При этом большая часть вещественных чисел, образующих континуум, может быть записана только в виде бесконечной последовательности ненулевых цифр. Так что же, целые p-адические числа это как p-ричные дроби, записанные наоборот? Простая формальность? Нет, это не так, они – целые, они – круче!</p>
<p>Множество вещественных чисел <span class="math display">ℝ</span> включает в себя множество рациональных <span class="math display">ℚ</span>, но кроме него оно содержит в себя все пределы фундаментальных последовательностей, сходящихся в <span class="math display">ℚ</span>, но не ему принадлежащих. Классические примеры таких пределов: <span class="math display">$$\sqrt{2}, \pi, \e$$</span> . Первое можно получить как предел последовательности конечных цепных дробей или шагов метода Ньютона, а второе и третье – в виде последовательности частичных сумм рядов Тэйлора и Лейбница. Все без исключения элементы этих последовательностей рациональны, а их пределы – нет. Таким образом, добавляя к <span class="math display">ℚ</span> все возможные пределы последовательностей из <span class="math display">ℚ</span>, мы пополняем его до <span class="math display">ℝ</span>. В целых числах тоже можно строить бесконечные последовательности, и можно даже говорить об их сходимости, если, начиная с какого-то шага все члены последовательности будут равны нулю. Мы используем полноту <span class="math display">ℤ</span> во многих целочисленных алгоритмах, как сигнал к завершению вычислений, например, в алгоритме Евклида для поиска наибольшего общего делителя.</p>
<p>Ключевое свойство p-адических чисел, отличающее их от больщих, но конечных колец <span class="math display">ℤ/<em>p</em><sup><em>k</em></sup>ℤ</span> состоит в том, что они включает в себя все пределы сходящихся последовательностей из своих элементов (сходящихся в особом, p-адическом смысле). При построени на основе кольца <span class="math display">ℤ<sub><em>p</em></sub></span> поля <span class="math display">ℚ<sub><em>p</em></sub></span> мы не теряем этой полноты, но приобретаем все формальные дроби, после чего можно задействовать ряд методов анализа, использующие понятия непрерывности, пределов и производных, метод Ньютона, ряды Тэйлора, экспоненты, логарифмы, тригонометрию, гамма- и дзета-функцию и прочие инструменты! Все они будут заметно отличаться от вещественных аналогов, сохраняя, впрочем, свои главные свойства, и работать смогут не всегда, но их наличие очень важно, когда речь заходит о серьёзной работе с числовыми системами.</p>
<p>Наконец, это поле <span class="math display">ℚ<sub><em>p</em></sub></span> можно алгебраически замкнуть, расширив его корнями алгебраических уравнений и преватив в поле p-адических комплексных чисел <span class="math display">ℂ<sub><em>p</em></sub></span>, которое уже оказывается изоморфным полю комплексных чисел, основанных на вещественных числах. То есть, наряду со стандартной цепочкой вложений числовых систем: <span class="math display">ℤ ⊂ ℚ ⊂ ℝ ⊂ ℂ,</span> можно строить альтернативные цепочки <span class="math display">ℤ/<em>p</em>ℤ ⊂ ℤ<sub><em>p</em></sub> ⊂ ℚ<sub><em>p</em></sub> ⊂ ℂ<sub><em>p</em></sub> ≃ ℂ,</span> , которые начинаются с конечных полей вычетов, и достигают алгебраического замыкания, минуя вещественные числа <span class="math display">ℝ</span>. Более того, в середине XX века Александр Островский доказал, что иных путей, ведущих к полным алгебраическими числовым системам не существует. Конечные поля вычетов (алгебра простых цифр), которые лежат в основе p-адических чисел, существенно проще для анализа чем натуральные числа. Там, конечно, тоже хватает технических трудностей, но к ним проще подступиться потому, хотя бы, что поля эти конечны. Очень многие общие результаты теории чисел и алгебраической геометрии могут быть получены переходом к 2-адическим числам, которые, как мы теперь понимаем, можно рассматривать как бесконечноразрядные двоичные дроби.</p>
<p>Начинаем с цифр</p>
<p>Давайте объясним этот изоморфизм компьютеру. Мы можем представить позиционную запись натурального числа списком цифр. При этом будет достаточно несложно написать две функции, переводящие натуральные числа в их цифровую запись по тому или иному основанию и набор арифметических функций со следующими типами:</p>
<p>Во всех этих функциях первый аргумент задаёт основание системы счисления. Написание этих функций, само по себе, хорошее упражнение, но перед тем как к нему приступать я хочу побеспокоиться о безопасности. От самого себя. Точнее, от возможных ошибок: моих – при написании этих функций и моих же (или кого-то ещё) – при их дальнейшем использовании. Желательно обеспечить безопасность не просто обвесив всё охраняющими условиями, и получая по рукам в рантайме, а так, чтобы некорректные данные были непредставимыми. Значит, нам надо начать с типов.</p>
<p>Я хочу, что бы цифры были ровно из того кольца вычетов, которое соответствовало бы основанию позиционной системы. То есть, чтобы было невозможно создать цифру 11 или –137 в системе с основанием 2 или 11. Тип Int нам тут не помощник, нужен тип для числа, вычисляемого в модулярной арифметике. Можно попробовать создать что-то вроде такого:</p>
<p>Но это ничего не решает: всё равно у нас нет уверенности в том, что основание цифр в списке будет одинаковым и что оно будет совпадать с основанием, записанным в типе Base. Абсолютно легитимным, например, будет такой несуразный экземпляр:</p>
<p>Я хочу поднять основание системы счисления на уровень типов, но при этом очень желательно оставить его числом, ведь нам потом с ним ещё предстоит работать. Для этих целей в Haskell существует понятие типов-литералов, представленных в библиотеке GHC.TypeLits. Подгрузим эту библиотеку вместе с необходимыми расширениями языка и определим тип для цифр.</p>
<p>Мы запретили отрицательные значения в качестве цифр, воспользовавшись типом Natural, и поставив тем самый первый заслон на уровне типов. Обратите внимание, у типа Z появился параметр-фантом m, то есть параметр, фигурирующий только в левой части определения и не появляющийся в правой. Тип этого параметра Nat это и есть тип-литерал, представляющий натуральные числа на уровне типов. Самое замечательное свойство типов-литералов состоит в том, что их можно описывать числом. Вот, например:</p>
<p>Типы-литералы были бы не особенно полезными, если бы не было возможности “спускать” их с уровня типов на уровень значений. Для этого служит функция natVal</p>
<p>Тип этой функции говорит, что если нам известен тип-литерал параметризующий какой-то другой тип proxy то мы можем превратить его в число типа Integer. В работе он очень прост:</p>
<p>Получаем абсолютно нормальное число, с которым можно производить вычисления. Отлично! Теперь можно приступить к определению числовой системы для цифр. Начнём с перевода целых чисел в модулярную арифметику цифр.</p>
<p>По задумке функция fromInteger должна приводить целое число к типу Natural после того, как оно будет превращено в остаток по модулю… а по какому модулю? Откуда мы узнаем цифра какой системы счисления будет создана? Как это бывает в ленивом Haskell мы отложим решение на потом: создадим ответ, а потом спросим у ответа его модуль. На момент создания, он уже будет в курсе.</p>
<p>Характерный для Haskell приём завязывания определений в рекурсивный узел работает и на уровне типов. Теперь мы способны создавать цифры из чисел в соответствии с выбранной системой счисления:</p>
<p>Именно по этому принципу построена библиотека для модулярной арифметики mod. В ней реализованы и отлично оптимизированы все необходимые для нас алгоритмы вычислений в кольцах вычетов. Так что мы не будем тратить время на построение своей собственной алгебры для цифр, а продолжим двигаться дальше, вооружившись этой библиотекой. Перепишем преамбулу нашего модуля.</p>
<p>При импортировании модуля GHC.TypeLits мы скрыли операцию для типов-литералов, тоже имеющую имя Mod . Теперь с цифрами стало работать несколько удобнее, поскольку они являются экземплярами многих полезных классов, в том числе, Num</p>
<p>Может показаться, что интерпретатор сначала выполняет действия, а потом переводит результат в тип Mod, но это не так. Аннотация типов только указывает, как интерпретировать числа-литералы и операции над ними. Говоря математическим языком, аннотация определяет алгебраическое кольцо, в котором мы работаем.</p>
<p>Есть в модулярной арифметике два пограничных случая: основание равное нулю и единице. В первом случае алгебра не определена, а во втором – тривиальна, то есть состоит из единственного элемента . Если второй случай, более или менее, алгебраически согласован, то первый вызывает ошибку в рантайме. Мы можем добавить на уровне типов информацию о том, что основание должно быть больше нуля. Для этого определим собственное ограничение, то есть тип, имеющий род Constraint .</p>
<p>Теперь попытка работать с нулевым модулем приведёт к ошибке на этапе компиляции, и в нашем коде вместо ограничения на тип-литерал KnownNat будет использоваться более предметно-ориентированное ограничение Base. Ну, что же, с цифрами по отдельности мы разобрались. Пора двигаться дальше.</p>
<p>Тип для целых чисел в позиционной записи обозначим обозначим параметризованным типом Z p, который соответствует математическому обозначению Zp , принятому для p-адических целых. Число в позиционной системе счисления по основанию – это непустая последовательность цифр, то есть, элементов в из кольца вычетов по модулю . Вот как можно было бы перевести такое определение на Haskell :</p>
<p>Списки в Haskell однородные по типу своих элементов, поэтому все цифры числа точно будут иметь одинаковое основание, согласованное с основанием самого числа. Коль скоро мы взяли курс на корректность на уровне типов, то вместо обыкновенного списка можно было бы использовать непустой список из библиотеки Data.List.NonEmpty. Очень скоро мы придём к иному более простому и более корректному решению, так что, пока ограничимся обыкновенным списком.</p>
<p>Добавим простое преобразование чисел в наше новое представление, а заодно реализуем удобную функцию show, которая удаляет лишние нули слева и разделяет цифры пробелами для систем с основанием превышающим 10.</p>
<p>Ну, что же, не считая использования нетривиальных типов, достижения наши, в общем, не ушли дальше упражнения для первого семестра первого курса или даже кружка программирования. Где же обещанная суровая теория чисел и прочие премудрости? Сейчас всё будет, а, вернее, уже есть! С технической точки зрения, целые p-адические числа ничем не отличаются от обычных чисел в позиционной записи, кроме одной детали – у них у всех бесконечное число разрядов. И поэтому они круче натуральных чисел!</p>
<p>в Это же рассуждение справедливо и для колец вычетов Z/mZ. Но, хотя они и “меньше” множества Z, в них может существовать то, чего нет в целых числах. Например, в них можно решить уравнение , если оказывается взаимно простым с порядком кольца . Это означает, что в модулярной арифметике можно рассуждать о частных от деления или о дробях. Например в Z/10Z существует дробь , потому что . А если кольцо вычетов имеет простой порядок, то в нём на месте числа могут оказаться все элементы, кроме нуля, что делает их полями – кольцами, замкнутыми относительно деления. В целых числах нет такого числа, которое бы при возведении в квадрат оказалось равным 2, а в поле Z/7Z такие числа есть: и , при этом они взаимно обратные, как полагается для квадратных корней: .</p>
<p>Это делает мир модулярных арифметик богаче мира целых чисел Z, но уж больно они маленькие. При отображении множества целых чисел на любую из них, мы теряем возможность различать числа, имеющие одинаковый остаток от деления на порядок арифметики. Ключевое свойство системы p-адических чисел состоит в том, что они пополняют кольца вычетов Z/pZ до такого кольца, которое включает в себя как все целые числа (различая их между собой), так и все те дроби, корни и прочие полезные числа, которые можно отыскать в порождающих его конечных кольцах! Причём, если в арифметике Z/10Z целое одно число решает такие уравнения, как , то при переходе к Z10 решения всех этих уравнений превратятся в различные целые числа, сохранив свойства, заданные уравнениями. Таким образом, Zp это пополнение системы дробей со знаменателями (сколь угодно большими), не кратными основанию , то есть, оно содержит в себе пределы сходящихся последовательностей из таких дробей (сходящихся в p-адическом смысле, конечно). Эта полнота позволяет использовать ряд методов анализа, использующие понятия пределов и производных, таких, например, как метод Ньютона, оставаясь при этом в целых числах, для которых применимы многие приёмы теории чисел.</p>
<p>Для того, чтобы преодолеть ограничение на знаменатели дробей и интегрировать все рациональные числа, нужно, во-первых, выбрать простое число в качестве основания, во-вторых, применить хорошо знакомый всем компьютерщикам и физикам приём разделения числа на мантиссу и порядок (положительный или отрицательный), только не в степенях десяти, а в степенях основания. Так на основе конечного кольца вычетов Z/pZ создаётся множество p-адических рациональных чисел Qp., в конечном итоге, дающее доступ к вещественнозначным инструментам. На нём можно рассматривать аналоги трансцендентным функциям – экспоненте, логарифму, гамма-функции и прочим. Наконец, это поле алгебраически замыкается в поле p-адических комплексных чисел Cp, которое уже оказывается изоморфным полю комплексных чисел, основанных на вещественных числах. То есть, наряду со стандартной цепочкой вложений числовых систем: можно строить альтернативные цепочки , которые начинаются с конечных полей вычетов, и достигают алгебраического замыкания, минуя вещественные числа R. Более того, в середине XX века Александр Островский доказал, что иных путей, ведущих к полным алгебраическими числовым системам не существует. Конечные поля вычетов (алгебра простых цифр), которые лежат в основе p-адических чисел, существенно проще для анализа чем натуральные числа. Там, конечно, тоже хватает технических трудностей, но к ним проще подступиться потому, хотя бы, что поля эти конечны. Очень многие общие результаты теории чисел и алгебраической геометрии могут быть получены переходом к 2-адическим числам, которые базируются на простейшем нетривиальном конечном числовом поле из двух элементов Z/2Z.</p>
<p>Важно упомянуть ещё об одном важном аспекте в классификации числовых систем. Одна из досадных неприятностей при вычислении чисел в позиционной записи состоит в несимметричности операции переноса – он всегда делается от младшего разряда к старшему, то есть, справа налево. В этом отношении бесконечный хвост цифр, уходящий налево принципиально лучше бесконечного хвоста, уходящего направо. Ведь переносы переходят именно справа, так что переполнение разряда где-то далеко в бесконечном ряду цифр при любой арифметической операции, может, в принципе, передаваясь по цепочке, повлиять на сколь угодно большой разряд. По существу, каждая цифра, действительного числа, вычислимого в позиционной записи, хранит потенциально бесконечную информацию о своём хвосте справа. С этим связаны всем знакомые проблемы округления и вытекающая из них неустойчивость вычислительных алгоритмов. В тоже самое время, арифметические действия, выполняемые поразрядно над целыми числами, которые “растут” только влево не могут повлиять на цифры, которые уже вычислены. Обрывание цепочки где-то далеко слева никак не изменит уже известных нам младших разрядов. На практике это заключается в следующем. Мы постоянно чувствуем конечность разрядности наших машин, работая с числами с плавающей точкой. 0.2 + 0.1 ==&gt; 0.30000000000000004, знакомо? При этом неважно с какими числами мы работаем, с большими или маленькими, ошибки округления, если можно так выразиться, плотно обступают любые числа. В то же самое время, конечность разрядов в целочисленных типах никак не влияет на точность вычислений для чисел, далёких от верхней границы, которая для 64 или даже 32 разрядной арифметики уже весьма и весьма велика! Потому так ценятся целочисленные алгоритмы. В этой основательной статье, которую я рекомендую всем заинтересовавшимся данной темой, приводится пример вычислительной устойчивости стандартных матричных операций в действительных и в p-адических числах. Вот, например как меняется число верных цифр при обращении матрицы Гильберта, простой, но неприятной матрицы, содержащей простые дроби. В обоих случаях использовалось одинаковое число бит для конечного представления числа.</p>
<p>Размерматрицы</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>13</p>
<p>50</p>
<p>100</p>
<p>IEEE</p>
<p>40</p>
<p>34</p>
<p>28</p>
<p>25</p>
<p>19</p>
<p>14</p>
<p>9</p>
<p>4</p>
<p>0</p>
<ul>
<li></li>
<li></li>
</ul>
<p>52</p>
<p>52</p>
<p>51</p>
<p>51</p>
<p>51</p>
<p>51</p>
<p>51</p>
<p>51</p>
<p>51</p>
<p>49</p>
<p>48</p>
<p>Выглядит впечатляюще! Но возникают резонные вопросы. Во-первых, отчего мы до сих пор не отказались от чисел с плавающей точкой и не перешли на 2-адические числа, раз уж мы всё равно используем двоичные числа для оцифровывания всего на свете? Всё дело в топологии. Топология – это не только про бублики и бутылки Клейна, как может показаться после знакомства с популярными введениями (это ещё один аналог monad-tutorial fallacy), она про такие свойства пространств и математических объектов, как непрерывность, связность, про их метрические свойства и отношения между ними, сохраняющие эти свойства. Так вот с топологическими свойствами у системы p-адических чисел беда. Их нельзя выстроить по порядку вдоль прямой, как мы привыкли это делать с целыми, рациональными или вещественными числами. Расстояние между двумя p-адическими числами, то есть, абсолютное значение их разности, которое позволяет рассуждать о точности вычислений и о сходимости последовательностей, может быть вычислено единственным способом и он абсолютно не согласуется каким-либо порядком в R. Более того “между” любыми двумя целыми числами можно можно отыскать сколько угодно других целых чисел, которые в привычной метрике оказались бы не просто далеко, а бесконечно далеко друг от друга! Впрочем, я взял слово “между” в кавычки, потому что и оно не совсем корректно для p &gt; 2, ибо числа при этом размещаются не на какой-то прямой, а на дерево-подобной структуре. При этом пересечение всех открытых интервалов (шаров) образует не континуум, как в топологии действительных чисел, а фрактальное несвязное канторово множество пример которого показан на рисунке в заголовке статьи. Так что мыслить шагами по числовой прямой или непрерывными перемещениями по ней никак не получится, а это очень важная деталь в математической картине физического мира, в котором малому относительному смещению двух точек в пространстве или времени соответствует малое изменение расстояния между ними. В p-адической метрике на это рассчитывать не приходится. С чем же связана такая оригинальная топология? Нельзя ли было построить её как-нибудь иначе? Увы Теорема Островского уверждает, что существует только два способа построения нетривиальных самосогласованных абсолютных значений для числовых сис</p>
<p>На уровне интуиции это можно понять таким образом. Как мы выясняем близки ли два вещественных числа друг к другу, если они представлены в позиционной системе (не важно, десятичной или двоичной)? Мы, начиная со старшего разряда сравниваем между собой цифры этих двух чисел. И чем длиннее оказывается непрерывная цепочка совпадающих цифр, тем ближе друг к другу они оказываются. Разница между двумя числами 123.456789 и 123.456689 существенно меньше, чем между 123.456789 и 113.456789, хотя в обоих случаях отличие состоит в единственной цифре. Так получаются, что в сходящихся последовательностях чисел всё больше цифр совпадает в из левой части. Вот как выглядит приближение к числу методом Ньютона:1.00000000000000001.50000000000000001.41666666666666651.41421568627450971.41421356237468991.4142135623730950</p>
<p>А теперь перевернём всё задом-наперёд, и скажем, что числа у нас имеют бесконечный хвост уходящий налево, при этом степень основания продолжает расти как росла, в том же направлении! Единственный способ сравнения, который нам остаётся, это такое же сравнение по цифрам, но совпадающие цифры мы можем считать только начиная с младшего разряда. Вот, например, как выглядит приближение к тому же тем же методом Ньютона, но в Z7:</p>
<p>…0000000000000000000000000000000000000004 …5151515151515151515151515151515151515154 …0452300452300452300452300452300452300454 …2202010030046244242322523014664645450454 …5455641253041334120254404655400245450454 …6416163312301130043502554655400245450454 …4026305612301130043502554655400245450454</p>
<p>Последовательность, и правда, сходится в p-адическом смысле: с каждым шагом число не меняющихся цифр растёт, но в старших разрядах царит хаос. В пределе мы получим то самое целое число, которое при возведении в квадрат будет в точности равно 2, но путь к нему с точки зрения вещественного порядка будет выглядеть бешеным метанием по числовой оси. Если мы будем рассматривать разности между последовательными членами нашей приближений, то цепочки совпадающих цифры (выделенные жирным), превратятся в постоянно увеличивающуюся цепочку нулей. Так выглядит последовательность p-адических чисел, монотонно убывающая по их абсолютному значению. Формально абсолютное значение на Zp определяют так: , где k – это число нулей в правой части числа, либо позиция младшего ненулевого разряда числа.</p>
<p>Так что, в обыкновенной жизни нам с такими числами будет оперировать крайне неудобно, но это не повод отказаться от знакомства с этим специфичным инструментом.</p>
<p>Возвращаемся в Haskell</p>
<p>После такого длительного мотивирущего отступления, пора вернуться к реализации p-адических чисел на компьютере, чтобы иметь возможность убедиться в сказанном выше самостоятельно.</p>
<p>Я не зря выбрал Haskell для работы с математическими абстракциями. Ленивые вычисления заменяют данные (бесконечную последовательность цифр) алгоритмом их порождающим (потенциально бесконечной генерацией новых верных цифр), но при этом алгоритм выглядит так, как будто мы оперируем с данными. Так что мы будем подразумевать и даже явно использовать бесконечность процесса генерации новых цифр. Но когда нам понадобится конкретная точность, мы сможет оборвать число в нужном нам месте. При этом вычислительная устойчивость p-адической арифметики, о которой мы говорили, обеспечит корректность последней полученной нами цифры.</p>
<p>Ну, что же, давайте сделаем наши числа бесконечноразрядными, явно указывая это в типе. Для этого мы воспользуемся типом InfList из маленькой библиотеки inflist.</p>
<p>У этого решения есть пара преимуществ перед предыдущим. Во-первых, бесконечность последовательности цифр автоматически сделает её непустой, так что мы получим ещё одну защиту от некорректности на уровне типов. А во-вторых, все функции, работающие с заведомо бесконечными списками, точно не будут создавать отложенных цепочек, как при левой свёртке, то есть, они будут генерировать по одному элементу списка по необходимости и передавать его друг другу по цепочке максимально эффективным способом (задействуя механизм list-fusion). А если мы сами напишем что-то нарушающее этот принцип, то тут же узнаем об этом, получив бесконечный цикл.</p>
<p>Впрочем, нет смысла заводить разговор о бесконечных цепочках, если мы не намерены их где-то обрывать. Иначе невозможно будет ни проверить наши числа на равенство (с ограниченной точностью, конечно), ни вывести их на монитор. Можно задать точность глобальным параметром, скажем, 16 или 20 цифр, но, как понимаете, это не вариант для теории чисел, где задачи бывают разными. Значит, надо вывести этот параметр наружу, например, включить наряду со списком цифр в тип Z p, но очень не хочется потом согласовывать точность чисел при выполнении всей арифметики. Кроме того, эта информация является в определённом смысле смысловым мусором, загромождая и код программы и пользовательский интерфейс. В отличие от типов, которые часто можно не указывать, рассчитывая на их вывод. Мы поместим информацию о точности в тип также как мы поместили туда информацию об основании системы счисления.</p>
<p>Для этого определим тип-обёртку над типом Z p, содержащий информацию о точности, а потом поступим хитро: мы поручим компилятору вывести экземпляры для сравнения и текстового представления наших чисел типу Z’ p prec , который знает про точность, а всю арифметику – типу Z p, которому информация о точности не нужна (для этого понадобится добавить ещё одно расширение языка).</p>
<p>Добавим ещё для прозрачности наших типов класс Digital, который обеспечивает доступ к последовательности цифр числа. Его интерфейс совсем несложный:</p>
<p>Теперь определим экземпляры классов Eq и Show для типа Z’ p prec</p>
<p>А после этого займёмся арифметикой для типа Z p. Это будет сделать относительно несложно, поскольку для цифр подходящая алгебра определена, и у нас есть необходимый инструментарий для работы с бесконечными списками.</p>
<p>Здесь мы использовали отображение с накоплением mappAccumL, и конструктор бесконечных списков (:::) , а также то обстоятельство, что цифры – это вычеты по известному нам модулю.</p>
<p>Если для сложения и умножения в столбик всё более или менее понятно (по крайней мере там нет ничего, что выходило бы за рамки школьной арифметики), то реализация функции смены знака negate требует комментария. Пока мы ничего не говорили о знаках p-адических чисел, как если бы они были расширением натуральных чисел. Однако с алгебраической точки зрения отрицательные числа нужны не столько для вычитания, сколько для того, чтобы наша система была группой по сложению, а для этого необходимо для каждого числа уметь отыскать элемент , такой, что их сумма будет равна нулю.</p>
<p>Посмотрим как это работает в привычной десятичной системе: 99 + 1 = 100, 999+1 = 1000 Прибавление единицы к числу, состоящему из одних только девяток , превращает все девятки, сколько бы их ни было, в ноль. Значит, если девяток в записи числа будет бесконечно много, то прибавление единицы к нему все их уничтожит и мы получим настоящий ноль. Соответственно, в системе Z10 роль единственного элемента, противоположного единице играет число, состоящее из одних девяток. Тут очень важна бесконечность цепочки, поскольку только в этом случае все девятки превратятся в нули и результат будет точным нейтральным элементом. Этот же принцип справедлив и в любой другой системе Zp число состоящее из одних только цифр будет играть роль числа . Произвольную цифру можно превратить в аналог девятки , если заменить её на (в её кольце вычетов ) и вычесть единицу. Это и делает наша функция negZ, превращая переданное её число в . Самый младший разряд при этом надо увеличить на единицу, чтобы получить в результате . Таким образом, все отрицательные числа тоже входят во множество целых p-адических чисел.</p>
<p>Читатель, знакомый с принципами организации вычислений в двоичных числах конечно же узнает способ кодировки отрицательных чисел: в Z2 роль числа играет бесконечная последовательность единиц, так же как в побитовом представлении целых чисел. Только разрядность нашего “процессора” в p-адических числах бесконечная, поэтому никакого переполнения никогда не случится и мы сможем представить единым образом все положительные и все отрицательные числа. Это не трюк и не фокус, а единственный аглебраически согласованный способ. Так что поздравляю всех компьютерщиков, вы уже давно работаете с подмножеством целых 2-адичных чисел, которое мы называем двоичными.</p>
<p>Ну, что же, мы написали уже около сотни строк кода. Пора посмотреть, как работает наша арифметика и насколько удобен созданный нами интерфейс.</p>
<p>Работая с Zp полезно сравнивать результаты своих размышлений или наблюдений с поведением чисел в небольших конечных полях, на которых эта система строится. Такие локальные наблюдения позволяют многое понять в глобальной картине, которую. нам рисуют p-адические числа. Например, то, что отрицательные числа гармонично входят во множество цифр, то есть, в Z/10Z не особенно удивительно. Стоит только представить его элементы в виде делений на круглом циферблате, и существование противоположных элементов становится очевидным. А раз так, то это должно быть верно и для кольца Z/100Z и для Z/100Z , а также для любого кольца вычетов по модулю степени десятки. В свою очередь, Z10, содержащее числа с бесконечным количеством разрядов, являются предельным объектом по отношению ко всем кольцам вычетов Z/10kZ . А значит, эта система вобрала в себя информацию и свойства сразу всех этих конечных колец, как океан, вобравший в себя свойства своих капель. В качестве простой иллюстрации этому принципу, давайте посмотрим как выглядит число обратное трём в кольцах вычетов по модулю степеней десяти:</p>
<p>Результат, полученный для каждого из колец вычетов содержит в себе часть общего результата. С другой стороны, если чего-то не существует в Z/pkZ, для какого-то , то этого не может существовать и в Zp . И наоборот, свойство или класс объектов, наблюдаемые в Zp можно найти и в любом из порождающих его конечных колец вычетов. Так можно доказывать разрешимость диофантовых или рациональных уравнений, справедливость сложных геометрических и аналитических результатов, постепенно поднимаясь от очень простых конечных структур к p-адическим, в которое они вложены.</p>
<p>Итак, мы научились оперировать числами из Z, переводя их в p-адические числа. Их представление абсолютно однозначно – это последовательность цифр, которая к какой-то позиции превращается в бесконечную последовательность нулей или “девяток”, то есть, максимальных цифр в выбранной системе счисления. Это универсальное свойство всех целых чисел позволяет отличить их от прочих и восстановить из p-адического представления, ограниченного известной точностью.</p>
<p>Я не буду больше приводить все детали реализации, интересующиеся могут заглянуть в репозиторий на GitHub, и посмотреть полный работающий код.</p>
<p>Целые числа образуют подкольцо в кольце Zp . Это значит, что, оперируя только целыми числами мы всегда будем получать только числа из этого же подкольца. Так не интересно, целые числа у нас и так уже есть. Чтобы вырваться из этого подкольца, можно искусственно сфабриковать какое-то число и проверить его свойства. Например что представляет собой 10-адическое число, состоящее из одних только шестёрок? Давайте поскладываем его с самим собой и поглядим, что будет получаться, (так на скучных уроках математики ребята балуются калькулятором).</p>
<p>Последний результат интересен – там много девяток, а значит, это какое-то небольшое по модулю отрицательное число. Если прибавить к нему то все девятки превратятся в нули. Действительно,</p>
<p>Значит, наше искусственное число решает такое уравнение и уже не принадлежит к образу какого-то целого числа. Кстати, сразу можно заключить, что раз в кольце вычетов по модулю 10 нет решения уравнения , в чём легко убедиться элементарным перебором, значит, такого числа нет и в 10-адических числах. Зато оно есть в 5-адических или 11-адических.</p>
<p>В общем случае легко выяснить какое уравнение решает число, представленное циклом длины с цифрами . Для это надо умножить это число на , что добавит ровно нулей справа, а потом прибавить число , что превратит результат в исходное число. Таким образом, имеем:</p>
<p>Например, для Z3 число, образованное повторением цифр уходящего года решает уравнение</p>
<p>В школе мы изучали способ деления чисел “уголком”. Когда мы таким образом делим целые числа, этот процесс рано или поздно заканчивается, давая нам частное и остаток от деления. При делении бесконечных цепочек остатка мы, конечно, не дождёмся, а вот частное при должном везении получить сможем! Значит, можно определить и для нашего типа Z p целочисленное деление, это позволит не конструировать дробные числа, а вычислять их:</p>
<p>Давайте лучше поищем что-нибудь, экзотическое, чего нет ни в целых, ни в рациональных числах. Как насчёт числа, отличного от нуля и единицы, которое было бы равно своему квадрату? Такого зверя точно нет ни в одной из числовых систем, ведущих от Z к C. А как насчёт цепочки, начинающейся с Z/10Z? Посмотрим, какие числа обладают этим свойством в начальном кольце:</p>
<p>Ну да, пятью-пять – двадцать пять, шестью-шесть – тридцать шесть. Знакомые с детства рифмы в кольце вычетов по модулю 10 звучат ещё лучше: пятью-пять – пять, шестью-шесть – шесть. С них и начнём поиски. Но предварительно обзаведёмся некоторым инструментарием.</p>
<p>Теперь можно искать методом итераций, отыскивая решение, как минимальную фиксированную точку отображения</p>
<p>Похоже, что первое чудо-число нам попалось! Проверим, так ли это?</p>
<p>А что с шестёркой? Эта точка неустойчива, поэтому метод итераций отыскать её не смог, но простая алгебра подсказывает, что если уравнение имеет корень то и тоже будет его корнем. Этому обстоятельству соответствует пара и во всех числовых системах, а в кольце Z/10Z ещё и пара и . У найденного нами 10-адического числа тоже есть пара:</p>
<p>Подобные пары нетривиальных решений можно обнаружить во всех кольцах Zp с четным основанием.</p>
<p>Давайте теперь поищем корни из целых чисел в разных системах. Для этого нам понадобится метод Ньютона, и при наличии целочисленного деления это не проблема!</p>
<p>Числа из Z, являющиеся полными квадратами, как правило дают целые корни (но не всегда). Из-за деления на 2 наш метод не сможет работать в Z2. Для этого случая существует специальный алгоритм, но я не буду сейчас на нём останавливаться. Зато покажу вот такого зверя:</p>
<p>Не стоит думать, что Z5 включает в себя мнимую единицу, просто p-адическое число -1 положительное число, как, впрочем, и все они.</p>
<p>https://youtu.be/lsOpyWmkU0o</p>
</html>
